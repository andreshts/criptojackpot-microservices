# ConfigMap for MongoDB init scripts - LOCAL
apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-init-scripts
  namespace: cryptojackpot
data:
  01-init-audit-db.js: |
    // Create audit database and collections
    // Note: Indexes are created by the application to ensure consistency
    db = db.getSiblingDB('cryptojackpot_audit');
    
    // Create audit_logs collection with schema validation
    db.createCollection('audit_logs', {
      validator: {
        $jsonSchema: {
          bsonType: 'object',
          required: ['timestamp', 'eventType', 'source'],
          properties: {
            timestamp: { bsonType: 'date' },
            eventType: { bsonType: 'string' },
            source: { bsonType: 'string' },
            userId: { bsonType: ['string', 'null'] },
            correlationId: { bsonType: ['string', 'null'] },
            resourceType: { bsonType: ['string', 'null'] },
            resourceId: { bsonType: ['string', 'null'] },
            data: { bsonType: 'object' }
          }
        }
      }
    });
    
    print('Audit database initialized successfully - indexes will be created by the application');
