# =============================================================================
# KEYCLOAK LOGIN THEME - CryptoJackpot
# =============================================================================
# Este ConfigMap contiene todos los recursos del tema de login personalizado.
# 
# ESTRUCTURA:
# - theme.properties: Configuración base del tema
# - login.css: Estilos CSS 
# - messages_en.properties: Traducciones en inglés
# - messages_es.properties: Traducciones en español
# - *.ftl: Templates FreeMarker para cada página
#
# PARA MODIFICAR:
# - Colores: Buscar "CSS Variables" en login.css
# - Logo: Buscar "#kc-header-wrapper::before" en login.css
# - Textos: Modificar messages_*.properties
# - Estructura HTML: Modificar los archivos *.ftl
# =============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-login-theme
  namespace: cryptojackpot
  labels:
    app: keycloak
    component: login-theme
data:
  # ===========================================================================
  # THEME PROPERTIES - Configuración base
  # ===========================================================================
  theme.properties: |
    parent=keycloak
    import=common/keycloak
    styles=css/login.css
    
  # ===========================================================================
  # CSS STYLES 
  # ===========================================================================
  login.css: |
    /* ===== CryptoJackpot Theme ===== */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    
    /* ----- CSS Variables ----- */
    :root {
      --body-font: 'Inter', sans-serif;
      --transition: all 0.5s ease-in-out;
      --p1: rgba(174, 254, 58, 1);      /* Primary green */
      --s1: rgba(85, 74, 255, 1);       /* Secondary purple */
      --act1: rgba(254, 68, 69, 1);     /* Error red */
      --act3: rgba(254, 201, 47, 1);    /* Warning yellow */
      --nw1: rgba(255, 255, 255, 1);
      --nw4: rgba(218, 218, 218, 1);
      --n0: #ffffff;
      --n2: rgba(26, 26, 26, 1);
      --n3: rgba(78, 78, 78, 1);
      --n4: rgba(0, 0, 0, 1);
    }

    /* ----- Global Styles ----- */
    html { scroll-behavior: smooth; }
    body {
      background-color: #000000 !important;
      font-family: var(--body-font) !important;
      font-size: 18px;
      line-height: 150%;
      min-height: 100vh;
      margin: 0 !important;
      padding: 0 !important;
    }
    a { text-decoration: none !important; color: var(--s1); transition: var(--transition); }
    a:hover { opacity: 0.8 !important; }
    h1, h2, h3, h4, h5, h6 { font-family: var(--body-font) !important; color: var(--n3) !important; font-weight: 800 !important; }

    /* ----- Hide Keycloak defaults ----- */
    .login-pf-page .login-pf-brand, #kc-locale, .login-pf-page .login-pf-footer, .pf-c-background-image { display: none !important; }

    /* ----- Page Container with Background Image ----- */
    .login-pf-page { 
      background-color: #000000 !important; 
      min-height: 100vh !important; 
      display: flex !important; 
      align-items: center !important; 
      justify-content: flex-start !important;
      position: relative !important;
      overflow: hidden !important;
    }
    .login-pf-page::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      width: 60%;
      height: 100%;
      background-image: url('https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/back-register.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: right center;
      pointer-events: none;
      z-index: 0;
    }
    .login-pf-page .card-pf { 
      background-color: transparent !important; 
      border: none !important; 
      box-shadow: none !important; 
      max-width: 380px !important; 
      padding: 24px 12px !important; 
      margin: 0 !important;
      margin-left: 10% !important;
      position: relative !important;
      z-index: 1 !important;
    }

    /* ----- Logo centrado encima del formulario ----- */
    #kc-header { 
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      width: 100% !important;
      text-align: center !important; 
      margin: 0 !important;
      padding: 0 !important;
      z-index: 0 !important;
      display: none !important;
    }
    #kc-header-wrapper { 
      display: none !important;
    }
    #kc-header-wrapper::before, #kc-header-wrapper::after { 
      display: none !important; 
    }
    
    /* Logo dentro del card */
    .login-pf-page .card-pf::before {
      content: '';
      display: block;
      width: 320px;
      height: 100px;
      margin: 0 auto 16px auto;
      background-image: url('https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/cryptojackpot-logo.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* ----- Page Title ----- */
    #kc-page-title { color: var(--n3) !important; font-size: 28px !important; font-weight: 700 !important; text-align: left !important; margin-bottom: 4px !important; margin-top: 0 !important; }

    /* ----- Form Elements ----- */
    .login-pf-page .form-group { margin-bottom: 12px !important; }
    .login-pf-page label { color: var(--n3) !important; font-size: 13px !important; margin-bottom: 4px !important; display: block !important; font-weight: 500 !important; }
    .login-pf-page input[type="text"], .login-pf-page input[type="password"], .login-pf-page input[type="email"], .login-pf-page input[type="tel"], .login-pf-page select {
      color: white !important; background-color: #000000 !important; border: 1px solid var(--nw4) !important;
      border-radius: 10px !important; padding: 12px 14px !important; width: 100% !important;
      font-size: 14px !important; box-sizing: border-box !important; transition: var(--transition) !important;
    }
    .login-pf-page select { appearance: none !important; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23dadada' d='M6 8L1 3h10z'/%3E%3C/svg%3E") !important; background-repeat: no-repeat !important; background-position: right 14px center !important; padding-right: 40px !important; cursor: pointer !important; }
    .login-pf-page select option { background-color: #1a1a1a !important; color: white !important; }
    .login-pf-page input::placeholder { color: rgba(255, 255, 255, 0.5) !important; }
    .login-pf-page input:focus, .login-pf-page select:focus { border-color: var(--s1) !important; outline: none !important; }
    
    /* ----- Form Row (2 columns) ----- */
    .form-row { display: flex !important; gap: 12px !important; }
    .form-row .form-group { flex: 1 !important; }
    @media (max-width: 480px) { .form-row { flex-direction: column !important; gap: 0 !important; } }

    /* ----- Buttons ----- */
    .login-pf-page .btn-primary, .login-pf-page #kc-login, .login-pf-page input[type="submit"] {
      display: inline-flex !important; align-items: center !important; justify-content: center !important;
      padding: 12px 20px !important; font-weight: 600 !important; border-radius: 10px !important;
      border: none !important; width: 100% !important; font-size: 14px !important;
      background: var(--s1) !important; color: var(--n0) !important; cursor: pointer !important; margin-top: 12px !important;
    }
    .login-pf-page .btn-primary:hover, .login-pf-page #kc-login:hover, .login-pf-page input[type="submit"]:hover { background: #4a3fd4 !important; }
    .login-pf-page .btn-default { background: transparent !important; border: 1px solid var(--nw4) !important; border-radius: 10px !important; color: var(--n3) !important; padding: 10px 16px !important; }

    /* ----- Links ----- */
    #kc-form-options { text-align: right !important; margin-bottom: 8px !important; }
    #kc-form-options a { color: var(--s1) !important; font-size: 13px !important; }
    #kc-registration { text-align: left !important; margin-bottom: 20px !important; }
    #kc-registration span { color: var(--n3) !important; font-size: 14px !important; }
    #kc-registration a { color: var(--s1) !important; font-weight: 600 !important; }

    /* ----- Alerts ----- */
    .login-pf-page .alert { padding: 10px 12px !important; border-radius: 8px !important; margin-bottom: 12px !important; font-size: 13px !important; }
    .login-pf-page .alert-error { background-color: rgba(254, 68, 69, 0.1) !important; border: 1px solid var(--act1) !important; color: var(--act1) !important; }
    .login-pf-page .alert-success { background-color: rgba(174, 254, 58, 0.1) !important; border: 1px solid var(--p1) !important; color: #155724 !important; }
    .login-pf-page .alert-warning { background-color: rgba(254, 201, 47, 0.1) !important; border: 1px solid var(--act3) !important; color: #856404 !important; }
    .login-pf-page .alert-info { background-color: rgba(85, 74, 255, 0.1) !important; border: 1px solid var(--s1) !important; color: var(--s1) !important; }
    .pf-c-form__helper-text.pf-m-error { color: var(--act1) !important; font-size: 11px !important; margin-top: 2px !important; }

    /* ----- Checkbox ----- */
    .login-pf-page input[type="checkbox"] { accent-color: var(--s1) !important; width: 16px !important; height: 16px !important; }

    /* ----- Password Toggle ----- */
    .password-wrapper { position: relative !important; display: flex !important; align-items: center !important; }
    .password-wrapper input { padding-right: 44px !important; }
    .password-toggle { position: absolute !important; right: 12px !important; top: 50% !important; transform: translateY(-50%) !important; background: transparent !important; border: none !important; cursor: pointer !important; padding: 4px !important; display: flex !important; align-items: center !important; justify-content: center !important; color: var(--n3) !important; transition: var(--transition) !important; }
    .password-toggle:hover { color: var(--s1) !important; }
    .password-toggle svg { width: 20px !important; height: 20px !important; }

    /* ----- Social Login ----- */
    #kc-social-providers { margin-top: 16px !important; }
    .social-divider { display: flex; align-items: center; text-align: center; margin: 16px 0 12px; }
    .social-divider::before, .social-divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--nw4); }
    .social-divider span { color: var(--n3); padding: 0 12px; font-size: 12px; }
    .social-links { list-style: none; padding: 0; margin: 0; }
    .social-links li { margin-bottom: 8px; }
    .social-link { background: transparent !important; border: 1px solid var(--nw4) !important; border-radius: 10px !important; color: var(--n3) !important; padding: 10px 16px !important; display: flex !important; align-items: center !important; justify-content: center !important; gap: 10px !important; font-weight: 600 !important; font-size: 13px !important; transition: var(--transition) !important; }
    .social-link:hover { border-color: var(--s1) !important; color: var(--s1) !important; background: rgba(85, 74, 255, 0.05) !important; }
    .social-link svg { flex-shrink: 0; }
    #kc-social-providers h4 { color: var(--n3) !important; text-align: center !important; font-size: 12px !important; margin-bottom: 12px !important; }

    /* ----- Responsive ----- */
    @media (max-width: 1299px) { 
      .login-pf-page::after { width: 50%; } 
      .login-pf-page .card-pf { margin-left: 5% !important; }
    }
    @media (max-width: 991px) { 
      .login-pf-page::after { display: none !important; } 
      .login-pf-page { justify-content: center !important; }
      .login-pf-page .card-pf { margin-left: 0 !important; margin: 0 auto !important; }
    }
    @media (max-width: 480px) { 
      .login-pf-page .card-pf { padding: 16px 12px !important; max-width: 100% !important; } 
      #kc-page-title { font-size: 22px !important; }
      .login-pf-page .card-pf::before { width: 280px; height: 85px; margin-bottom: 12px; }
    }
    
    /* ----- Register Form Mobile Fix ----- */
    @media (max-width: 991px) {
      body:has(#kc-register-form) { 
        overflow-y: auto !important; 
        overflow-x: hidden !important;
        height: auto !important;
        min-height: 100vh !important;
      }
      body:has(#kc-register-form) .login-pf-page { 
        min-height: auto !important; 
        height: auto !important;
        align-items: flex-start !important;
        padding: 24px 16px 48px !important;
        overflow: visible !important;
      }
      body:has(#kc-register-form) .card-pf { 
        margin-top: 0 !important;
        margin-bottom: 24px !important;
        max-width: 420px !important;
        width: 100% !important;
      }
      body:has(#kc-register-form) .card-pf::before {
        display: block !important;
        width: 280px !important;
        height: 85px !important;
        margin: 0 auto 20px auto !important;
        background-image: url('https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/cryptojackpot-logo.png') !important;
        background-size: contain !important;
        background-repeat: no-repeat !important;
        background-position: center !important;
        content: '' !important;
      }
    }
    @media (max-width: 480px) {
      body:has(#kc-register-form) .login-pf-page { 
        padding: 16px 12px 40px !important; 
      }
      body:has(#kc-register-form) .card-pf { 
        padding: 16px 14px !important; 
        max-width: 100% !important;
      }
      body:has(#kc-register-form) .card-pf::before { 
        width: 220px !important; 
        height: 65px !important; 
        margin-bottom: 16px !important; 
      }
      body:has(#kc-register-form) #kc-page-title { 
        font-size: 22px !important; 
        margin-bottom: 12px !important; 
        text-align: center !important;
      }
      body:has(#kc-register-form) .form-group { 
        margin-bottom: 12px !important; 
      }
      body:has(#kc-register-form) label { 
        font-size: 13px !important; 
        margin-bottom: 4px !important; 
      }
      body:has(#kc-register-form) input, 
      body:has(#kc-register-form) select { 
        padding: 12px 14px !important; 
        font-size: 14px !important; 
      }
      body:has(#kc-register-form) .form-row {
        flex-direction: column !important;
        gap: 0 !important;
      }
      body:has(#kc-register-form) input[type="submit"] {
        margin-top: 16px !important;
        padding: 14px 20px !important;
        font-size: 15px !important;
      }
    }

  # ===========================================================================
  # MESSAGES - English
  # ===========================================================================
  messages_en.properties: |
    loginTitle=Sign In
    doLogIn=Sign In
    usernameOrEmail=Email
    passwordLabel=Password
    rememberMe=Remember me
    noAccount=New user?
    doRegister=Create Account
    doForgotPassword=Forgot your password?
    registerTitle=Create Account
    loginLinkTitle=Already have an account?
    emailLabel=Email
    firstNameLabel=First Name
    lastNameLabel=Last Name
    passwordConfirmLabel=Confirm Password
    phoneLabel=Phone Number
    countryLabel=Country
    statePlaceLabel=State / Province
    cityLabel=City
    addressLabel=Address
    identificationLabel=ID / Passport Number
    selectCountry=Select a country
    emailForgotTitle=Reset Password
    emailInstruction=Enter your email and we'll send you a link to reset your password.
    updatePasswordTitle=Create New Password
    passwordNew=New Password
    passwordNewConfirm=Confirm New Password
    emailVerifyTitle=Verify Your Email
    emailVerifyInstruction=An email with verification instructions has been sent to your email address.
    doClickHere=Click here to resend
    doSubmit=Submit
    doCancel=Cancel
    invalidUserMessage=Invalid email or password
    missingUsernameMessage=Please enter your email.
    identity-provider-login-label=Or continue with
    emailSendErrorMessage=Your account was created successfully! However, we couldn''t send the verification email. Please try again later or contact support.
    errorTitle=Oops!
    emailErrorInfo=Don''t worry, your registration is complete. You can request a new verification email from your account settings.
    backToApplication=Go to Application
    backToLogin=Go to Login
    proceedWithAction=Continue

  # ===========================================================================
  # MESSAGES - Spanish
  # ===========================================================================
  messages_es.properties: |
    loginTitle=Iniciar Sesión
    doLogIn=Iniciar Sesión
    usernameOrEmail=Email
    passwordLabel=Contraseña
    rememberMe=Recordarme
    noAccount=¿Nuevo usuario?
    doRegister=Crear Cuenta
    doForgotPassword=¿Olvidaste tu contraseña?
    registerTitle=Crear Cuenta
    loginLinkTitle=¿Ya tienes cuenta?
    emailLabel=Correo Electrónico
    firstNameLabel=Nombre
    lastNameLabel=Apellido
    passwordConfirmLabel=Confirmar Contraseña
    phoneLabel=Número de Teléfono
    countryLabel=País
    statePlaceLabel=Estado / Provincia
    cityLabel=Ciudad
    addressLabel=Dirección
    identificationLabel=Número de Identificación
    selectCountry=Selecciona un país
    emailForgotTitle=Restablecer Contraseña
    emailInstruction=Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.
    backToLogin=Volver a Iniciar Sesión
    updatePasswordTitle=Crear Nueva Contraseña
    passwordNew=Nueva Contraseña
    passwordNewConfirm=Confirmar Nueva Contraseña
    emailVerifyTitle=Verifica tu Correo
    emailVerifyInstruction=Se ha enviado un correo con instrucciones de verificación.
    doClickHere=Haz clic aquí para reenviar
    doSubmit=Enviar
    doCancel=Cancelar
    invalidUserMessage=Correo o contraseña inválidos
    missingUsernameMessage=Por favor indica tu correo electrónico.
    identity-provider-login-label=O continuar con
    emailSendErrorMessage=¡Tu cuenta fue creada exitosamente! Sin embargo, no pudimos enviar el correo de verificación. Por favor intenta más tarde o contacta a soporte.
    errorTitle=¡Ups!
    emailErrorInfo=No te preocupes, tu registro está completo. Puedes solicitar un nuevo correo de verificación desde la configuración de tu cuenta.
    backToApplication=Ir a la Aplicación
    proceedWithAction=Continuar

  # ===========================================================================
  # TEMPLATE BASE - Con favicon personalizado
  # ===========================================================================
  template.ftl: |
    <#macro registrationLayout bodyClass="" displayInfo=false displayMessage=true displayRequiredFields=false>
    <!DOCTYPE html>
    <html<#if realm.internationalizationEnabled> lang="${locale.currentLanguageTag}"</#if>>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <#-- Content Security Policy to allow API calls via Ingress -->
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' http://cryptojackpot.local http://cryptojackpot.local:80 https://api.cryptojackpot.com https://*.cryptojackpot.com;">
        
        <#-- Favicon personalizado desde CDN -->
        <link rel="icon" href="https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/favicon.ico">
        <link rel="shortcut icon" href="https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/favicon.ico">
        <link rel="apple-touch-icon" href="https://cryptojackpot.sfo3.cdn.digitaloceanspaces.com/resources/favicon.ico">
        
        <#if properties.meta?has_content>
            <#list properties.meta?split(' ') as meta>
                <meta name="${meta?split('==')[0]}" content="${meta?split('==')[1]}"/>
            </#list>
        </#if>
        <title>${msg("loginTitle",(realm.displayName!''))}</title>
        <#if properties.stylesCommon?has_content>
            <#list properties.stylesCommon?split(' ') as style>
                <link href="${url.resourcesCommonPath}/${style}" rel="stylesheet" />
            </#list>
        </#if>
        <#if properties.styles?has_content>
            <#list properties.styles?split(' ') as style>
                <link href="${url.resourcesPath}/${style}" rel="stylesheet" />
            </#list>
        </#if>
    </head>
    <body class="login-pf-page ${bodyClass}">
        <div id="kc-header" class="login-pf-page-header">
            <div id="kc-header-wrapper">${kcSanitize(msg("loginTitleHtml",(realm.displayNameHtml!'')))?no_esc}</div>
        </div>
        <div class="card-pf">
            <header class="login-pf-header">
                <#if !(auth?has_content && auth.showUsername() && !auth.showResetCredentials())>
                    <#if displayRequiredFields>
                        <div class="subtitle"><span class="required">*</span> ${msg("requiredFields")}</div>
                    </#if>
                <#else>
                    <#if displayRequiredFields>
                        <div class="subtitle"><span class="required">*</span> ${msg("requiredFields")}</div>
                    </#if>
                </#if>
                <#nested "header">
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper">
                    <#if displayMessage && message?has_content && (message.type != 'warning' || !isAppInitiatedAction??)>
                        <div class="alert-${message.type} pf-m-<#if message.type = 'error'>danger<#else>${message.type}</#if>">
                            <span class="pf-c-alert__title kc-feedback-text">${kcSanitize(message.summary)?no_esc}</span>
                        </div>
                    </#if>
                    <#nested "form">
                    <#if auth?has_content && auth.showTryAnotherWayLink()>
                        <form id="kc-select-try-another-way-form" action="${url.loginAction}" method="post">
                            <input type="hidden" name="tryAnotherWay" value="on"/>
                            <a href="#" id="try-another-way" onclick="document.forms['kc-select-try-another-way-form'].submit();return false;">${msg("doTryAnotherWay")}</a>
                        </form>
                    </#if>
                    <#nested "socialProviders">
                    <#if displayInfo>
                        <div id="kc-info"><div id="kc-info-wrapper"><#nested "info"></div></div>
                    </#if>
                </div>
            </div>
        </div>
        <script>
            function togglePassword(inputId, btn) {
                var input = document.getElementById(inputId);
                var eyeIcon = btn.querySelector('.eye-icon');
                var eyeOffIcon = btn.querySelector('.eye-off-icon');
                if (input.type === 'password') {
                    input.type = 'text';
                    eyeIcon.style.display = 'none';
                    eyeOffIcon.style.display = 'block';
                } else {
                    input.type = 'password';
                    eyeIcon.style.display = 'block';
                    eyeOffIcon.style.display = 'none';
                }
            }
        </script>
    </body>
    </html>
    </#macro>

  # ===========================================================================
  # TEMPLATE - Login
  # ===========================================================================
  login.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayMessage=!messagesPerField.existsError('username','password') displayInfo=realm.password && realm.registrationAllowed && !registrationDisabled??; section>
        <#if section = "header">${msg("loginTitle")}
        <#elseif section = "form">
            <div id="kc-form"><div id="kc-form-wrapper">
                <#-- Link de registro arriba del formulario -->
                <#if realm.password && realm.registrationAllowed && !registrationDisabled??>
                    <div id="kc-registration"><span>${msg("noAccount")} <a href="${url.registrationUrl}">${msg("doRegister")}</a></span></div>
                </#if>
                
                <#if realm.password>
                    <form id="kc-form-login" action="${url.loginAction}" method="post">
                        <div class="form-group">
                            <label for="username">${msg("usernameOrEmail")}</label>
                            <input id="username" name="username" value="${(login.username!'')}" type="text" autofocus autocomplete="email" placeholder="${msg("usernameOrEmail")}"/>
                            <#if messagesPerField.existsError('username','password')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.getFirstError('username','password'))?no_esc}</span></#if>
                        </div>
                        <div class="form-group">
                            <label for="password">${msg("passwordLabel")}</label>
                            <div class="password-wrapper">
                                <input id="password" name="password" type="password" autocomplete="current-password" placeholder="${msg("passwordLabel")}"/>
                                <button type="button" class="password-toggle" onclick="togglePassword('password', this)" aria-label="Toggle password visibility">
                                    <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    <svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <#-- Link de recuperar contraseña -->
                        <#if realm.resetPasswordAllowed>
                            <div id="kc-form-options"><a href="${url.loginResetCredentialsUrl}">${msg("doForgotPassword")}</a></div>
                        </#if>
                        
                        <#-- Remember me checkbox -->
                        <#if realm.rememberMe && !usernameHidden??>
                            <div class="form-group" style="margin-top:16px"><label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                                <input id="rememberMe" name="rememberMe" type="checkbox" <#if login.rememberMe??>checked</#if>>${msg("rememberMe")}
                            </label></div>
                        </#if>
                        
                        <#-- Botón de login -->
                        <div id="kc-form-buttons">
                            <input type="hidden" name="credentialId" <#if auth.selectedCredential?has_content>value="${auth.selectedCredential}"</#if>/>
                            <input id="kc-login" type="submit" value="${msg("doLogIn")}"/>
                        </div>
                    </form>
                </#if>
                
                <#-- Botones de Social Login (Google, etc) -->
                <#if realm.password && social.providers??>
                    <div id="kc-social-providers">
                        <div class="social-divider"><span>${msg("identity-provider-login-label")}</span></div>
                        <ul class="social-links">
                            <#list social.providers as p>
                                <li><a id="social-${p.alias}" class="social-link" href="${p.loginUrl}">
                                    <#if p.alias == "google">
                                        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                    </#if>
                                    <span>${p.displayName!}</span>
                                </a></li>
                            </#list>
                        </ul>
                    </div>
                </#if>
            </div></div>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Register
  # ===========================================================================
  register.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayMessage=!messagesPerField.existsError('firstName','lastName','email','password','password-confirm','user.attributes.phone','user.attributes.country','user.attributes.statePlace','user.attributes.city'); section>
        <#if section = "header">${msg("registerTitle")}
        <#elseif section = "form">
            <div style="margin-bottom:20px"><span style="color:var(--n3);font-size:14px">${msg("loginLinkTitle")} <a href="${url.loginUrl}" style="color:var(--s1);font-weight:600">${msg("doLogIn")}</a></span></div>
            <form id="kc-register-form" action="${url.registrationAction}" method="post">
                <#-- Row: First Name & Last Name -->
                <div class="form-row">
                    <div class="form-group"><label>${msg("firstNameLabel")} *</label><input type="text" id="firstName" name="firstName" value="${(register.formData.firstName!'')}" placeholder="${msg("firstNameLabel")}"/><#if messagesPerField.existsError('firstName')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('firstName'))?no_esc}</span></#if></div>
                    <div class="form-group"><label>${msg("lastNameLabel")} *</label><input type="text" id="lastName" name="lastName" value="${(register.formData.lastName!'')}" placeholder="${msg("lastNameLabel")}"/><#if messagesPerField.existsError('lastName')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('lastName'))?no_esc}</span></#if></div>
                </div>
                
                <#-- Email -->
                <div class="form-group"><label>${msg("emailLabel")} *</label><input type="email" id="email" name="email" value="${(register.formData.email!'')}" placeholder="${msg("emailLabel")}"/><#if messagesPerField.existsError('email')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('email'))?no_esc}</span></#if></div>
                
                <#-- Row: Phone & Country -->
                <div class="form-row">
                    <div class="form-group"><label>${msg("phoneLabel")}</label><input type="tel" id="user.attributes.phone" name="user.attributes.phone" value="${(register.formData['user.attributes.phone']!'')}" placeholder="${msg("phoneLabel")}"/><#if messagesPerField.existsError('user.attributes.phone')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('user.attributes.phone'))?no_esc}</span></#if></div>
                    <div class="form-group"><label>${msg("countryLabel")} *</label>
                        <select id="user.attributes.country" name="user.attributes.country" required>
                            <option value="">${msg("selectCountry")}</option>
                        </select>
                        <#if messagesPerField.existsError('user.attributes.country')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('user.attributes.country'))?no_esc}</span></#if>
                    </div>
                </div>
                
                <#-- Row: State & City -->
                <div class="form-row">
                    <div class="form-group"><label>${msg("statePlaceLabel")} *</label><input type="text" id="user.attributes.statePlace" name="user.attributes.statePlace" value="${(register.formData['user.attributes.statePlace']!'')}" placeholder="${msg("statePlaceLabel")}" required/><#if messagesPerField.existsError('user.attributes.statePlace')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('user.attributes.statePlace'))?no_esc}</span></#if></div>
                    <div class="form-group"><label>${msg("cityLabel")} *</label><input type="text" id="user.attributes.city" name="user.attributes.city" value="${(register.formData['user.attributes.city']!'')}" placeholder="${msg("cityLabel")}" required/><#if messagesPerField.existsError('user.attributes.city')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('user.attributes.city'))?no_esc}</span></#if></div>
                </div>
                
                <#-- Address (optional) -->
                <div class="form-group"><label>${msg("addressLabel")}</label><input type="text" id="user.attributes.address" name="user.attributes.address" value="${(register.formData['user.attributes.address']!'')}" placeholder="${msg("addressLabel")}"/></div>
                
                <#-- Row: Password & Confirm Password -->
                <div class="form-row">
                    <div class="form-group"><label>${msg("passwordLabel")} *</label><div class="password-wrapper"><input type="password" id="password" name="password" placeholder="${msg("passwordLabel")}"/><button type="button" class="password-toggle" onclick="togglePassword('password', this)" aria-label="Toggle password visibility"><svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg></button></div><#if messagesPerField.existsError('password')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('password'))?no_esc}</span></#if></div>
                    <div class="form-group"><label>${msg("passwordConfirmLabel")} *</label><div class="password-wrapper"><input type="password" id="password-confirm" name="password-confirm" placeholder="${msg("passwordConfirmLabel")}"/><button type="button" class="password-toggle" onclick="togglePassword('password-confirm', this)" aria-label="Toggle password visibility"><svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg></button></div><#if messagesPerField.existsError('password-confirm')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('password-confirm'))?no_esc}</span></#if></div>
                </div>
                
                <div id="kc-form-buttons"><input type="submit" value="${msg("doRegister")}"/></div>
            </form>
            
            <#-- Script to load countries from Identity API via Ingress -->
            <script>
                (function() {
                    var countrySelect = document.getElementById('user.attributes.country');
                    var savedValue = '${(register.formData['user.attributes.country']!'')}';
                    var loadingOption = countrySelect.querySelector('option');
                    
                    // Determine API URL based on Keycloak hostname
                    // Keycloak runs at: auth.cryptojackpot.local (local) or auth.cryptojackpot.com (prod)
                    // API runs at: cryptojackpot.local (local) or api.cryptojackpot.com (prod)
                    var hostname = window.location.hostname;
                    var protocol = window.location.protocol;
                    var apiBaseUrl;
                    
                    if (hostname.includes('auth.cryptojackpot.local') || hostname === 'localhost') {
                        // Local K8s: Keycloak at auth.cryptojackpot.local, API at cryptojackpot.local
                        apiBaseUrl = 'http://cryptojackpot.local';
                    } else if (hostname.includes('auth.')) {
                        // Production: auth.cryptojackpot.com -> api.cryptojackpot.com
                        apiBaseUrl = protocol + '//' + hostname.replace('auth.', 'api.');
                    } else {
                        // Fallback: same domain structure
                        apiBaseUrl = protocol + '//' + hostname.replace('keycloak.', '');
                    }
                    
                    var apiUrl = apiBaseUrl + '/api/v1/countries';
                    
                    loadingOption.textContent = 'Loading...';
                    
                    fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        },
                        mode: 'cors'
                    })
                    .then(function(response) {
                        if (!response.ok) throw new Error('HTTP ' + response.status);
                        return response.json();
                    })
                    .then(function(result) {
                        // Clear loading option
                        countrySelect.innerHTML = '<option value="">${msg("selectCountry")}</option>';
                        
                        // API returns { success: true, data: [...] } or just [...]
                        var countries = result.data || result;
                        
                        if (Array.isArray(countries)) {
                            countries.forEach(function(country) {
                                var option = document.createElement('option');
                                option.value = country.id.toString();
                                option.textContent = country.name;
                                if (savedValue === country.id.toString()) {
                                    option.selected = true;
                                }
                                countrySelect.appendChild(option);
                            });
                        }
                    })
                    .catch(function(error) {
                        console.error('Failed to load countries:', error.message, 'URL:', apiUrl);
                        loadingOption.textContent = '${msg("selectCountry")}';
                    });
                })();
            </script>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Reset Password
  # ===========================================================================
  login-reset-password.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayInfo=true displayMessage=!messagesPerField.existsError('username'); section>
        <#if section = "header">${msg("emailForgotTitle")}
        <#elseif section = "form">
            <form action="${url.loginAction}" method="post">
                <p style="color:var(--n3);font-size:14px;margin-bottom:24px">${msg("emailInstruction")}</p>
                <div class="form-group"><label>${msg("emailLabel")}</label><input type="email" id="username" name="username" autofocus placeholder="${msg("emailLabel")}" value="${(auth.attemptedUsername!'')}"/><#if messagesPerField.existsError('username')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.getFirstError('username'))?no_esc}</span></#if></div>
                <div id="kc-form-buttons"><input type="submit" value="${msg("doSubmit")}"/></div>
                <div style="text-align:center;margin-top:16px"><a href="${url.loginUrl}">${msg("backToLogin")}</a></div>
            </form>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Update Password
  # ===========================================================================
  login-update-password.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayMessage=!messagesPerField.existsError('password','password-confirm'); section>
        <#if section = "header">${msg("updatePasswordTitle")}
        <#elseif section = "form">
            <form action="${url.loginAction}" method="post">
                <input type="hidden" name="username" value="${username}"/>
                <div class="form-group"><label>${msg("passwordNew")} *</label><div class="password-wrapper"><input type="password" id="password-new" name="password-new" autofocus placeholder="${msg("passwordNew")}"/><button type="button" class="password-toggle" onclick="togglePassword('password-new', this)" aria-label="Toggle password visibility"><svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg></button></div><#if messagesPerField.existsError('password')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('password'))?no_esc}</span></#if></div>
                <div class="form-group"><label>${msg("passwordNewConfirm")} *</label><div class="password-wrapper"><input type="password" id="password-confirm" name="password-confirm" placeholder="${msg("passwordNewConfirm")}"/><button type="button" class="password-toggle" onclick="togglePassword('password-confirm', this)" aria-label="Toggle password visibility"><svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><svg class="eye-off-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg></button></div><#if messagesPerField.existsError('password-confirm')><span class="pf-c-form__helper-text pf-m-error">${kcSanitize(messagesPerField.get('password-confirm'))?no_esc}</span></#if></div>
                <div id="kc-form-buttons"><input type="submit" value="${msg("doSubmit")}"/><#if isAppInitiatedAction??><button class="btn-default" type="submit" name="cancel-aia" value="true" style="margin-top:10px">${msg("doCancel")}</button></#if></div>
            </form>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Verify Email
  # ===========================================================================
  login-verify-email.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayInfo=true; section>
        <#if section = "header">${msg("emailVerifyTitle")}
        <#elseif section = "form">
            <div style="text-align:center;padding:40px 0">
                <div style="width:80px;height:80px;margin:0 auto 24px;background:rgba(85,74,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(85,74,255,1)" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                </div>
                <p style="color:var(--n3);font-size:16px;line-height:1.6;margin-bottom:24px">${msg("emailVerifyInstruction")}</p>
                <a href="${url.loginAction}" style="color:var(--s1);font-weight:600">${msg("doClickHere")}</a>
            </div>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Error Page (Custom friendly error messages)
  # ===========================================================================
  error.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayMessage=false; section>
        <#if section = "header">
            ${msg("errorTitle")}
        <#elseif section = "form">
            <div style="text-align:center;padding:30px 0">
                <#-- Check if this is an email error (registration was successful but email failed) -->
                <#if message?has_content && message.summary?contains("email")>
                    <#-- Success icon for email errors (registration was successful) -->
                    <div style="width:80px;height:80px;margin:0 auto 24px;background:rgba(174,254,58,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(174,254,58,1)" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                    </div>
                    <h3 style="color:var(--p1);font-size:20px;margin-bottom:16px;font-weight:700">¡Registro Exitoso!</h3>
                    <p style="color:var(--n3);font-size:15px;line-height:1.6;margin-bottom:12px">${msg("emailSendErrorMessage")}</p>
                    <p style="color:var(--n3);font-size:13px;line-height:1.5;margin-bottom:24px;opacity:0.8">${msg("emailErrorInfo")}</p>
                <#else>
                    <#-- Warning icon for other errors -->
                    <div style="width:80px;height:80px;margin:0 auto 24px;background:rgba(254,201,47,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(254,201,47,1)" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    </div>
                    <p style="color:var(--n3);font-size:15px;line-height:1.6;margin-bottom:24px">
                        <#if message?has_content>${kcSanitize(message.summary)?no_esc}</#if>
                    </p>
                </#if>
                <#if client?? && client.baseUrl?has_content>
                    <a href="${client.baseUrl}" style="display:inline-block;background:var(--s1);color:white;padding:12px 24px;border-radius:10px;font-weight:600;font-size:14px;text-decoration:none">${msg("backToApplication")}</a>
                </#if>
            </div>
        </#if>
    </@layout.registrationLayout>

  # ===========================================================================
  # TEMPLATE - Info Page (Email verified, action completed, etc.)
  # ===========================================================================
  info.ftl: |
    <#import "template.ftl" as layout>
    <@layout.registrationLayout displayMessage=false; section>
        <#if section = "header">
            <#if messageHeader??>
                ${messageHeader}
            <#else>
                ${message.summary}
            </#if>
        <#elseif section = "form">
            <div style="text-align:center;padding:40px 0">
                <div style="width:80px;height:80px;margin:0 auto 24px;background:rgba(174,254,58,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(174,254,58,1)" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                </div>
                <p style="color:var(--n3);font-size:16px;line-height:1.6;margin-bottom:24px">${message.summary}</p>
                <#if skipLink??>
                <#else>
                    <#if actionUri?has_content>
                        <a href="${actionUri}" style="display:inline-block;background:var(--s1);color:white;padding:14px 32px;border-radius:10px;font-weight:600;font-size:15px;text-decoration:none">${kcSanitize(msg("proceedWithAction"))?no_esc}</a>
                    <#else>
                        <a href="${url.loginUrl}" style="display:inline-block;background:var(--s1);color:white;padding:14px 32px;border-radius:10px;font-weight:600;font-size:15px;text-decoration:none">${kcSanitize(msg("backToLogin"))?no_esc}</a>
                    </#if>
                </#if>
            </div>
        </#if>
    </@layout.registrationLayout>
