# Keycloak Realm Configuration ConfigMap
# Este ConfigMap contiene la configuración del realm para importación automática
apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-realm-config
  namespace: cryptojackpot
  labels:
    app: keycloak
data:
  realm-export.json: |
    {
      "realm": "cryptojackpot",
      "enabled": true,
      "displayName": "CryptoJackpot",
      "displayNameHtml": "<div class=\"kc-logo-text\"><span>CryptoJackpot</span></div>",
      "sslRequired": "external",
      "registrationAllowed": true,
      "registrationEmailAsUsername": true,
      "rememberMe": true,
      "verifyEmail": true,
      "loginWithEmailAllowed": true,
      "duplicateEmailsAllowed": false,
      "resetPasswordAllowed": true,
      "editUsernameAllowed": false,
      "bruteForceProtected": true,
      "permanentLockout": false,
      "maxFailureWaitSeconds": 900,
      "minimumQuickLoginWaitSeconds": 60,
      "waitIncrementSeconds": 60,
      "quickLoginCheckMilliSeconds": 1000,
      "maxDeltaTimeSeconds": 43200,
      "failureFactor": 5,
      "loginTheme": "cryptojackpot",
      "emailTheme": "cryptojackpot",
      "smtpServer": {
        "host": "${SMTP_HOST}",
        "port": "${SMTP_PORT}",
        "from": "${SMTP_FROM}",
        "fromDisplayName": "CryptoJackpot",
        "replyTo": "${SMTP_REPLY_TO:support@cryptojackpot.com}",
        "ssl": "false",
        "starttls": "true",
        "auth": "true",
        "user": "${SMTP_USER}",
        "password": "${SMTP_PASSWORD}"
      },
      "roles": {
        "realm": [
          {
            "name": "admin",
            "description": "Administrator role with full access",
            "composite": false
          },
          {
            "name": "user",
            "description": "Standard user role",
            "composite": false
          },
          {
            "name": "moderator",
            "description": "Moderator role with limited admin access",
            "composite": false
          }
        ]
      },
      "clients": [
        {
          "clientId": "account-console",
          "name": "Account Console",
          "enabled": false,
          "publicClient": true,
          "standardFlowEnabled": true,
          "protocol": "openid-connect"
        },
        {
          "clientId": "cryptojackpot-backend",
          "name": "CryptoJackpot Backend API",
          "description": "Backend API client for microservices",
          "enabled": true,
          "clientAuthenticatorType": "client-secret",
          "secret": "cryptojackpot-backend-secret-change-in-production",
          "publicClient": false,
          "bearerOnly": false,
          "consentRequired": false,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "directAccessGrantsEnabled": true,
          "serviceAccountsEnabled": true,
          "authorizationServicesEnabled": true,
          "protocol": "openid-connect",
          "redirectUris": [
            "http://localhost:5000/*",
            "http://localhost:5001/*",
            "https://api.cryptojackpot.com/*"
          ],
          "webOrigins": [
            "http://localhost:5000",
            "http://localhost:3000",
            "https://cryptojackpot.com",
            "https://www.cryptojackpot.com",
            "https://app.cryptojackpot.com"
          ],
          "attributes": {
            "access.token.lifespan": "3600"
          },
          "protocolMappers": [
            {
              "name": "user-id-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "user_id",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "user_id",
                "jsonType.label": "long"
              }
            },
            {
              "name": "realm-roles-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-realm-role-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "multivalued": "true",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "roles",
                "jsonType.label": "String"
              }
            },
            {
              "name": "phone-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "phone",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "phone",
                "jsonType.label": "String"
              }
            },
            {
              "name": "country-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "country",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "country",
                "jsonType.label": "String"
              }
            },
            {
              "name": "statePlace-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "statePlace",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "statePlace",
                "jsonType.label": "String"
              }
            },
            {
              "name": "city-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "city",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "city",
                "jsonType.label": "String"
              }
            },
            {
              "name": "address-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "address",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "address",
                "jsonType.label": "String"
              }
            }
          ]
        },
        {
          "clientId": "cryptojackpot-frontend",
          "name": "CryptoJackpot Frontend SPA",
          "description": "Public client for frontend SPA application",
          "enabled": true,
          "publicClient": true,
          "bearerOnly": false,
          "consentRequired": false,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "directAccessGrantsEnabled": false,
          "serviceAccountsEnabled": false,
          "protocol": "openid-connect",
          "redirectUris": [
            "http://localhost:3000/*",
            "https://cryptojackpot.com/*",
            "https://www.cryptojackpot.com/*",
            "https://app.cryptojackpot.com/*"
          ],
          "webOrigins": [
            "http://localhost:3000",
            "https://cryptojackpot.com",
            "https://www.cryptojackpot.com",
            "https://app.cryptojackpot.com"
          ],
          "attributes": {
            "access.token.lifespan": "300",
            "pkce.code.challenge.method": "S256"
          },
          "protocolMappers": [
            {
              "name": "user-id-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "user_id",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "user_id",
                "jsonType.label": "long"
              }
            },
            {
              "name": "realm-roles-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-realm-role-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "multivalued": "true",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "roles",
                "jsonType.label": "String"
              }
            },
            {
              "name": "phone-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "phone",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "phone",
                "jsonType.label": "String"
              }
            },
            {
              "name": "country-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "country",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "country",
                "jsonType.label": "String"
              }
            },
            {
              "name": "statePlace-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "statePlace",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "statePlace",
                "jsonType.label": "String"
              }
            },
            {
              "name": "city-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "city",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "city",
                "jsonType.label": "String"
              }
            },
            {
              "name": "address-mapper",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "address",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "address",
                "jsonType.label": "String"
              }
            }
          ]
        }
      ],
      "identityProviders": [
        {
          "alias": "google",
          "displayName": "Google",
          "providerId": "google",
          "enabled": false,
          "updateProfileFirstLoginMode": "on",
          "trustEmail": true,
          "storeToken": true,
          "addReadTokenRoleOnCreate": false,
          "authenticateByDefault": false,
          "linkOnly": false,
          "firstBrokerLoginFlowAlias": "first broker login",
          "config": {
            "clientId": "google-client-id-placeholder",
            "clientSecret": "google-client-secret-placeholder",
            "defaultScope": "openid email profile",
            "syncMode": "IMPORT"
          }
        }
      ],
      "requiredActions": [
        {
          "alias": "CONFIGURE_TOTP",
          "name": "Configure OTP",
          "providerId": "CONFIGURE_TOTP",
          "enabled": true,
          "defaultAction": false,
          "priority": 10
        },
        {
          "alias": "UPDATE_PASSWORD",
          "name": "Update Password",
          "providerId": "UPDATE_PASSWORD",
          "enabled": true,
          "defaultAction": false,
          "priority": 30
        },
        {
          "alias": "VERIFY_EMAIL",
          "name": "Verify Email",
          "providerId": "VERIFY_EMAIL",
          "enabled": true,
          "defaultAction": false,
          "priority": 50
        }
      ],
      "otpPolicyType": "totp",
      "otpPolicyAlgorithm": "HmacSHA1",
      "otpPolicyDigits": 6,
      "otpPolicyPeriod": 30,
      "passwordPolicy": "length(8) and maxLength(128) and notUsername and notEmail",
      "eventsEnabled": true,
      "eventsListeners": [
        "jboss-logging"],
      "enabledEventTypes": [
        "LOGIN",
        "LOGIN_ERROR",
        "LOGOUT",
        "REGISTER",
        "REGISTER_ERROR"
      ],
      "adminEventsEnabled": true,
      "internationalizationEnabled": true,
      "supportedLocales": [
        "en",
        "es"],
      "defaultLocale": "en",
      "attributes": {
        "userProfileEnabled": "true",
        "userProfile": "{\"attributes\":[{\"name\":\"username\",\"displayName\":\"${username}\",\"validations\":{\"length\":{\"min\":3,\"max\":255},\"username-prohibited-characters\":{},\"up-username-not-idn-homograph\":{}},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\"]}},{\"name\":\"email\",\"displayName\":\"${email}\",\"validations\":{\"email\":{},\"length\":{\"max\":255}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"firstName\",\"displayName\":\"${firstName}\",\"validations\":{\"length\":{\"max\":255},\"person-name-prohibited-characters\":{}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"lastName\",\"displayName\":\"${lastName}\",\"validations\":{\"length\":{\"max\":255},\"person-name-prohibited-characters\":{}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"phone\",\"displayName\":\"${phoneLabel}\",\"validations\":{\"length\":{\"max\":50}},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"country\",\"displayName\":\"${countryLabel}\",\"validations\":{\"length\":{\"max\":10}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"statePlace\",\"displayName\":\"${statePlaceLabel}\",\"validations\":{\"length\":{\"max\":100}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"city\",\"displayName\":\"${cityLabel}\",\"validations\":{\"length\":{\"max\":100}},\"required\":{\"roles\":[\"user\"]},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}},{\"name\":\"address\",\"displayName\":\"${addressLabel}\",\"validations\":{\"length\":{\"max\":200}},\"permissions\":{\"view\":[\"admin\",\"user\"],\"edit\":[\"admin\",\"user\"]}}],\"groups\":[{\"name\":\"user-metadata\",\"displayHeader\":\"User Metadata\",\"displayDescription\":\"Additional user information\"}]}"
      }
    }
